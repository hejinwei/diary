<%
	DIRECTIVE SAFE_OUTPUT_OPEN;
%>

<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>${webName}</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <link rel="alternate icon" type="image/png" href="${contextPath}/static/assets/i/favicon.ico">
  <link rel="stylesheet" href="${contextPath}/static/assets/css/amazeui.min.css"/>
  
  <style>
    @media only screen and (min-width: 1200px) {
      .blog-g-fixed {
        max-width: 1200px;
      }
    }

    @media only screen and (min-width: 641px) {
      .blog-sidebar {
        font-size: 1.4rem;
      }
    }

    .blog-main {
      padding: 20px 0;
    }

    .blog-title {
      margin: 10px 0 20px 0;
    }

    .blog-meta {
      font-size: 14px;
      margin: 10px 0 20px 0;
      color: #222;
    }

    .blog-meta a {
      color: #27ae60;
    }

    .blog-pagination a {
      font-size: 1.4rem;
    }

    .blog-team li {
      padding: 4px;
    }

    .blog-team img {
      margin-bottom: 0;
    }

    .blog-content img,
    .blog-team img {
      max-width: 100%;
      height: auto;
    }

    .blog-footer {
      padding: 10px 0;
      text-align: center;
    }
  </style>
</head>
<body>
<header class="am-topbar">
  <h1 class="am-topbar-brand">
    <a href="#">${webName}</a>
  </h1>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only"
          data-am-collapse="{target: '#doc-topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span
      class="am-icon-bars"></span></button>

  <div class="am-collapse am-topbar-collapse" id="doc-topbar-collapse">
    <ul class="am-nav am-nav-pills am-topbar-nav">
      <!-- <li class="am-active"><a href="#">首页</a></li> -->
      <li><a href="${contextPath}/mine">我的</a></li>
      <!-- <li><a href="#">项目</a></li>
      <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          菜单 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
          <li class="am-dropdown-header">标题</li>
          <li><a href="#">关于我们</a></li>
          <li><a href="#">关于字体</a></li>
          <li><a href="#">TIPS</a></li>
        </ul>
      </li> -->
    </ul>

    <form class="am-topbar-form am-topbar-left am-form-inline am-topbar-right" role="search" >
      <div class="am-form-group">
        <input type="text" id="nickname" class="am-form-field am-input-sm" placeholder="昵称">
      </div>
      <button type="button" class="am-btn am-btn-default am-btn-sm" onclick="searchPeople()">找人</button>
    </form>

  </div>
</header>

	<div class="am-g am-g-fixed blog-g-fixed">
		<div class="am-g">
			<div class="am-u-sm-12 am-u-md-12">
				<div class="am-fl am-cf">
					<strong class="am-text-primary am-text-lg">${owner.nickname}</strong>
				</div>
			</div>
		</div>
		
		<hr>


		<div class="am-u-md-8">${layoutContent}</div>

		<div class="am-u-md-4 blog-sidebar">

			<div class="am-panel-group">

				<section class="am-panel am-panel-default">
					<!-- <div class="am-panel-hd">头像</div> -->
					<div class="am-panel-bd">
						<img alt="${owner.nickname}" src="${owner.headImage}"
							style="width: 100%">
					</div>
				</section>

				<section class="am-panel am-panel-default">
					<div class="am-panel-hd">个性签名</div>
					<div class="am-panel-bd">
						<p id="signContent">${owner.sign!}</p>
					</div>
				</section>
				<section class="am-panel am-panel-default">
					<div class="am-panel-hd">热门日记</div>
					<ul class="am-list blog-list" id="hotDiaries">

					</ul>
				</section>

				<section class="am-panel am-panel-default">
					<div class="am-panel-hd">公告</div>
					<div class="am-panel-bd">
						<p>时光静好，与君语；细水流年，与君同。</p>
						<p>—— 有情人终成眷属</p>
					</div>
				</section>
			</div>
		</div>

	</div>

	<footer class="blog-footer">
  <p>blog template<br/>
    <small>© 版权还没弄</small>
  </p>
</footer>

<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="${contextPath}/static/assets/js/jquery.min.js"></script>
<!--<![endif]-->
<script src="${contextPath}/static/assets/js/amazeui.min.js"></script>

<script>

jQuery(document).ready(function() {
	// 热门日记
	$.ajax( {  
	    url:'${contextPath}/getTop5/' + ${owner.userId}, 
	    data:{  
	    },
	    type:'get',  
	    cache:false,  
	    dataType:'json',
	    success:function(data) {
	    	data = eval("(" + data + ")");
	        if(data.size > 0 ){
	        	$.each(data.data, function(i, item) {
	        		var functionDesc = "preViewDiary('" + item.diaryId + "', '" + item.privateType + "')";
	        		var line = '<li><a href="javascript:void(0)" onclick="' + functionDesc + '">' + item.title +'</a></li>';
	        		//var line = '<li><a href="${contextPath}/viewDiary/' + item.diaryId + '">' + item.title +'</a></li>';
	        		$('#hotDiaries').append(line);
	        	});  
	        } 
	     },  
	     error : function() {  
	          console.log("异常！");  
	     }  
	});
	
});


function searchPeople() {
	
	var nickname = $.trim($('#nickname').val());
	
	if (nickname == '') {
		alert('要输入昵称额...');
		return;
	}
	
	nickname = encodeURIComponent(encodeURIComponent(nickname));
	window.location.href = '${contextPath}/doSearchPeople?nickname=' + nickname;
}


function preViewDiary(diaryId, privateType) {
	
	if (privateType == 'PUBLIC') {
		viewDiary(diaryId, privateType, null);
	}
	
	// 判断私密类型
	if (privateType == 'PROTECTED') {
		// 加密类型，判断密码
		var password = window.prompt("请输入密码","");
		if (password == null || $.trim(password) == '') {
			alert("密码不能为空");
			return;
		}
		
		// ajax 判断密码是否正确
		$.ajax({
            type:"GET",
            //提交的网址
            url:"${contextPath}/checkPassword/" + diaryId,
            //提交的数据
            data:{password:password},
            //返回数据的格式
            dataType: "json",//"xml", "html", "script", "json", "jsonp", "text".
            //成功返回之后调用的函数             
            success:function(data){
           		data = eval('(' + data + ')');
           		if (data.code != 0) {
           			alert(data.message);
           			return;
           		} else {
           			viewDiary(diaryId, privateType, password);
           		}
            },
           
            //调用出错执行的函数
            error: function(){
                //请求出错处理
            	console.log("error函数");
            }         
         });
	}
}

function viewDiary(diaryId, privateType, password) {
	
	if (privateType != 'PROTECTED') {
		window.location.href = '${contextPath}/viewDiary/' + diaryId;
	} else {
		var turnForm = document.createElement("form");
		//一定要加入到body中！！   
		document.body.appendChild(turnForm);
		turnForm.method = 'post';
		turnForm.action = '${contextPath}/viewDiary/' + diaryId;
		//turnForm.target = '_blank';
		//创建隐藏表单
		var newElement = document.createElement("input");
		newElement.setAttribute("name", "password");
		newElement.setAttribute("type", "hidden");
		newElement.setAttribute("value", password);
		turnForm.appendChild(newElement);

		turnForm.submit();
	}
}

</script>

${pageLevelJS}

</body>
</html>

<%
	//关闭安全输出。
	DIRECTIVE SAFE_OUTPUT_CLOSE;
%>